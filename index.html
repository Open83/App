<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saniya's Habit Tracker</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff99aa">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Habit Tracker">
</head>
<body>
  <header>
    <h1>ğŸŒ¸ Saniya's Habit Tracker</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="gallery.html">Gallery</a>
    </nav>
  </header>
  
  <main>
    <!-- Loading Section -->
    <section id="loading" class="loading-section">
      <div class="loading-spinner"></div>
      <p>Loading your habits...</p>
    </section>

    <!-- Progress Bar -->
    <section id="progress-bar">
      <div id="progress-fill"></div>
      <span id="progress-text">0%</span>
    </section>

    <!-- Current Day Info -->
    <section id="current-day-info">
      <p id="day-info">Today is your habit day!</p>
    </section>

    <!-- Calendar -->
    <section id="calendar"></section>

    <!-- Task Section -->
    <section id="task-section" class="hidden">
      <h2 id="task-title">Today's Habit</h2>
      <div id="task-desc"></div>
      <div class="file-upload-container">
        <label for="proof-upload" class="file-upload-label">
          ğŸ“¸ Upload Photo/Video Proof
        </label>
        <input type="file" id="proof-upload" accept="image/*,video/*" class="file-upload-input">
      </div>
      <button id="mark-done" class="complete-btn">Mark as Done âœ…</button>
    </section>

    <!-- Points -->
    <section id="points-section">
      <div class="points-card">
        <h3>Your Progress</h3>
        <p>Total Points: <span id="points">0</span>/300</p>
        <div class="achievement-badges">
          <span class="badge">ğŸŒŸ Starter</span>
          <span class="badge locked">ğŸ† Champion</span>
        </div>
      </div>
    </section>
  </main>

  <!-- Popup -->
  <div id="popup" class="hidden">
    <div class="popup-overlay"></div>
    <div id="popup-content">
      <div class="popup-message"></div>
      <button id="close-popup" class="popup-close">Close</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-storage-compat.js"></script>
  
  <!-- App Logic -->
  <script src="app.js"></script>
  
  <script>
    // Enhanced PWA Installation
    let deferredPrompt;
    let installButton;

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallButton();
    });

    function showInstallButton() {
      if (!installButton) {
        installButton = document.createElement("button");
        installButton.innerHTML = "ğŸ“± Add to Home Screen";
        installButton.className = "install-btn";
        document.body.appendChild(installButton);
        
        installButton.addEventListener("click", async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const choiceResult = await deferredPrompt.userChoice;
            if (choiceResult.outcome === 'accepted') {
              console.log('PWA installed');
            }
            deferredPrompt = null;
            installButton.remove();
            installButton = null;
          }
        });
      }
    }

    // Handle successful installation
    window.addEventListener('appinstalled', () => {
      console.log('PWA was installed');
      if (installButton) {
        installButton.remove();
        installButton = null;
      }
    });

    // Register Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(registration => console.log('SW registered'))
        .catch(error => console.log('SW registration failed'));
    }

    // Update current day info
    function updateDayInfo() {
      const startTime = localStorage.getItem('habitStartTime');
      if (startTime) {
        const start = parseInt(startTime);
        const now = new Date().getTime();
        const daysPassed = Math.floor((now - start) / (24 * 60 * 60 * 1000)) + 1;
        const currentDay = Math.min(daysPassed, 30);
        
        const dayInfo = document.getElementById('day-info');
        if (dayInfo) {
          if (currentDay <= 30) {
            dayInfo.textContent = `Today is Day ${currentDay} of your 30-day journey!`;
          } else {
            dayInfo.textContent = `ğŸ‰ You've completed your 30-day journey! ğŸ‰`;
          }
        }
      }
    }

    // Update day info periodically
    setInterval(updateDayInfo, 60000); // Update every minute
    document.addEventListener('DOMContentLoaded', updateDayInfo);
  </script>
</body>
</html>
